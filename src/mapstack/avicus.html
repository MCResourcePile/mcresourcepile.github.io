{{> header}}
<div class="container">
	<div class="content-header">
        {{> alert}}
		<div class="content-title">Public Map Listing</div>
		<div class="content-subtitle">
			A collection of publicly downloadable maps from the <a href="http://avicus.net">Avicus Network</a>.
		</div>
	</div>
	<!-- Game mode navigation menu -->
	<form name="search_form" class="record-search-container">
		<input type="search" id="search" name="s" value="" class="form-control record-search-box" placeholder="Search maps">
	</form>
	<div class="game-mode-navigation row">
		<div class="col-xs-6 col-md-3">
			<div class="game-mode-section-header">Objectives</div>
			<a class="game-mode-button game_ctf" href="?s=ctf"></a>
			<a class="game-mode-button game_ctw" href="?s=ctw"></a>
			<a class="game-mode-button game_dtm" href="?s=dtm"></a>
			<a class="game-mode-button game_dtc" href="?s=dtc"></a>
			<a class="game-mode-button game_koth" href="?s=koth"></a>
		</div>
		<div class="col-xs-6 col-md-3">
			<div class="game-mode-section-header">Deathmatch</div>
			<a class="game-mode-button game_frenzy" href="?s=frenzy"></a>
			<a class="game-mode-button game_skywars" href="?s=skywars"></a>
			<a class="game-mode-button game_tdm" href="?s=tdm"></a>
		</div>
		<div class="col-xs-6 col-md-3">
			<div class="game-mode-section-header">Competitive</div>
			<a class="game-mode-button game_tournament" href="?s=tournament"></a>
		</div>
		<div class="col-xs-6 col-md-3">
			<div class="game-mode-section-header">Other</div>
			<a class="game-mode-button game_all" href="?s=" ></a>
			<a class="game-mode-button game_arcade" href="?s=arcade"></a>
			<span class="game-mode-button">Licenses:</span>
			<a class="game-mode-button license_by_nc_sa" href="?s=by-nc-sa"></a>
			<a class="game-mode-button license_by_sa" href="?s=by-sa"></a>
		</div>
	</div>
	<div class="total-maps center"></div>
	<div id="maps-output" class="maps-output">
		<div class="dynamic">
		{{#with data}}
        {{#maps}}
            {{> map}}
		{{/maps}}
		{{/with}}
		</div>
	</div>
	<div class="modal fade" id="download-complete-message" tabindex="-1" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">Your download will begin shortly...</h4>
				</div>
				<div class="modal-body">
					Thank you for downloading this map from ResourcePile and supporting free public maps as well as the map authors.<br><br>
					<small>If your download does not begin, an error may have occured or the map you are looking for may not exisit in our public repository yet. Please try again, but if the issue persists please report an issue on our <a href="https://github.com/MCResourcePile/MCResourcePile.github.io/issues/new" target="_blank">Issues Tracker</a>.</small>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="download-error-message" tabindex="-1" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">The download failed.</h4>
				</div>
				<div class="modal-body">
				Something went wrong. Please try again. If the issue persists please report an issue on our <a href="https://github.com/MCResourcePile/MCResourcePile.github.io/issues/new" target="_blank">Issues Tracker</a>.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="download-rate-limit-message" tabindex="-1" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">You've hit the rate limit</h4>
				</div>
				<div class="modal-body">
					Looks like you've hit GitHub's rate limit. Sadly there isn't anything we can do about that at the moment, but we are looking for solutions. Please try again in an hour.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	setTimeout(function () {
		makeSearchable()

		$(function () {
			$('[data-toggle="tooltip"]').tooltip()
		})

		var total_hidden = $('.dynamic').children('.no-download').length;
		var maps_no_download = $.map($(".no-download"), function(n, i){
			return "\n- " + n.id;
		});
		if(total_hidden > 0){
			console.log(total_hidden + " maps have no download and have been hidden from this listing.\nPlease contact a page manager to add or enable the downloads for the following maps:" + maps_no_download)
		}
	}, 1000);

	$(document).on('ready', function(){
		makeSearchable()
	})

	$('.record-search-container').on('click', function(){
		makeSearchable()
	})

	$(document).on('keydown', function() {
		makeSearchable()
	});

	function makeSearchable(){
		$('#maps-output .dynamic').searchable({
			selector: 'div.map-thumbnail',
			childSelector: '.map-float',
			searchField: '#search'
		})

		var total_maps = $('.map-thumbnail').length
		var total_display = $('.map-thumbnail:visible').length
		var total_official = $('.official-map:visible').length
		var total_unofficial = $('.unofficial-map:visible').length
        
        if (total_maps == "0") {
            $(".total-maps").html("No maps successfully loaded<br>Please check the console for any errors and contact a page manager");
        } else if (total_display == "0") {
            $(".total-maps").html("Current query references no maps, please try searching something else");
        } else {
            $(".total-maps").html("Currently displaying " + total_display + " of " + total_maps + " loaded maps");
        }
	}

    var license = true;
    var commercial = true;

    function commercialLicense(){
        license = true;
        commercial = true;
        console.log("This map is using a Creative Commons BY-SA 4.0 license")
    }

    function noncommercialLicense(){
        license = true;
        commercial = false;
        console.log("This map is using a Creative Commons BY-NC-SA 4.0 license")
    }

    function noLicense(){
        license = false;
        console.log("This map has no associated license; be careful when using this map in public servers")
    }

	GitZip.registerCallback(function(status, message, percent) {
		if (status === "done") {
			$("#download-complete-message").modal('show')
		}
		else if (status ==="error") {
			if (message.indexOf("API rate limit exceeded for") === -1) {
				$("#download-error-message").modal('show');
			}
			else {
				$("#download-rate-limit-message").modal('show');
			}
		}
	});
</script>
<script type="text/javascript">
	var data=location.search;
	if(data) {
		data=location.search.substring(1);
		data=data.split('&');
		var pairs={};
		for(var i=0; i<data.length; i++){
			var tmp=data[i].split('=');
			pairs[tmp[0]]=tmp[1];
		}
		var f = document.search_form;
		for (var i in pairs) {
			if(f.elements[i]) {f.elements[i].value = pairs[i];}
		}
	}
</script>
{{> footer}}
</body>
</html>
